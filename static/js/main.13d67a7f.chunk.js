(this["webpackJsonpsong-search-xstate-local"]=this["webpackJsonpsong-search-xstate-local"]||[]).push([[0],{48:function(e,t,n){e.exports=n.p+"static/media/loading.0f51771c.svg"},49:function(e,t,n){e.exports=n.p+"static/media/search.fa72ba04.svg"},50:function(e,t,n){e.exports=n.p+"static/media/cross.4f744e82.svg"},53:function(e,t,n){e.exports=n(83)},58:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var a=n(2),o=n.n(a),r=n(43),i=n.n(r),c=(n(58),n(17)),s=Object(c.a)(),l=n(11),u=n(20),d=n(47),f=n(26),g=n(15),v=function(e,t){return Math.random()*(t-e)+e},m={searchPage:{on:{SET_KEYWORD:[{cond:"isEmptyKeyword",actions:["setKeyword","resetResult"],target:".idle.idle"},{cond:"isInvalidKeyword",actions:["setKeyword"]},{cond:"skipDebounceSearch",actions:["setKeyword"],target:".searching"},{actions:["setKeyword"],target:".buffering",internal:!1}],TOGGLE_CLEAR:[{cond:"hasNoResult",actions:"clearKeyword",target:".idle.idle"},{cond:"withKeyword",actions:"clearKeyword"},{actions:"resetResult",target:".idle.idle"}]},initial:"idle",states:{idle:{initial:"idle",states:{idle:{},withData:{on:{READ_MORE:{actions:"readMore"}}},noData:{}}},buffering:{after:Object(g.a)({},500,"searching")},searching:{entry:["searchSongList","scrollToTop"],exit:["updateKeywordParam","sendDimension","setPageview"],always:[{cond:"hasNoResult",target:"idle.noData"},{target:"idle.withData"}]}}}},h={root:{initial:"startup",states:{startup:{entry:["initialGA","sendDimension","setPageview"],always:[{cond:"withSettingInLocalStorage",target:"idle",actions:["restoreSetting","filterSongList"]},{target:"fetchRawData"}]},fetchRawData:{invoke:{id:"fetch-initial-data",src:"fetchInitialData",onDone:{target:"idle",actions:["initializeData","storeSetting","filterSongList"]},onError:"error"}},processData:{after:Object(g.a)({},v(2e3,4e3),"arrangeRawData")},arrangeRawData:{after:Object(g.a)({},v(2e3,4e3),"optimizeSearchSpeed")},optimizeSearchSpeed:{after:Object(g.a)({},v(1e3,3e3),"idle")},idle:{type:"parallel",states:Object(l.a)(Object(l.a)({},{menu:{initial:"closed",on:{CLOSE_MENU:".closed",OPEN_MENU:".opened"},states:{closed:{on:{TOGGLE_MENU:"opened"}},opened:{on:{TOGGLE_MENU:"closed"}}}}}),m)},error:{on:{RETRY:"fetchRawData"}}}}},b=n(7),w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=localStorage.getItem(e);return JSON.parse(t)},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=JSON.stringify(t);return localStorage.setItem(e,n),n},O={INITIAL_DATA:"initial-data",SELECTED_BOOKS_VOLUME_RANGE:"selected-books-volume-range",SELECTED_BOOKS:"selected-books"},p={"\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)":[1,104]},k=["book","title","artist","volume"],y={withSettingInLocalStorage:function(){return Object(b.values)(O).every((function(e){return!Object(b.isEmpty)(w(e))}))},isEmptyKeyword:function(e,t){var n=t.keyword;return Object(b.isEmpty)(n)},isInvalidKeyword:function(e,t){var n,a=t.keyword;return n=Object(b.last)(a),/[\u3105-\u3129\u02CA\u02C7\u02CB\u02D9]/.test(n)||" "===Object(b.last)(a)},withKeyword:function(e){var t=e.keyword;return!Object(b.isEmpty)(t)},hasNoResult:function(e){var t=e.result;return Object(b.isEmpty)(t)},skipDebounceSearch:function(e,t){return t.skipDebounce}},j=n(3),S=n(44),R=function(e,t){var n=e.filter((function(e){return e.book===t})).map((function(e){var t=e.volume;return Object(b.toInteger)(t)}));return[Object(b.min)(n),Object(b.max)(n)]},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return((null===e||void 0===e?void 0:e.booksWithVolumeFilter)||[]).reduce((function(t,n){var a;return Object(l.a)(Object(l.a)({},t),{},Object(g.a)({},n,R(null!==(a=null===e||void 0===e?void 0:e.songs)&&void 0!==a?a:[],n)))}),{})},L={initialGA:function(e){e.ReactGA.initialize("UA-192564086-1",{debug:!1})},setPageview:function(e){e.ReactGA.pageview(window.location.pathname+window.location.search)},sendDimension:function(e){var t=e.ReactGA,n=e.keyword,a=void 0===n?"":n;t.set({ua:navigator.userAgent}),t.set({k:a})}},D={setKeyword:Object(j.b)({keyword:function(e,t){var n=t.keyword;return void 0===n?"":n}}),clearKeyword:Object(j.b)({keyword:""}),resetResult:Object(j.b)({result:[],pageNumber:1}),readMore:Object(j.b)({pageNumber:function(e){return e.pageNumber+1}}),searchSongList:Object(j.b)({result:function(e){var t=e.songList,n=e.keyword;return Object(S.a)(t,n.replace(/[\r\n\s]/g,""),{keys:k})}}),initializeData:Object(j.b)((function(e,t){var n=t.data.data,a=n.songs,o=void 0===a?[]:a,r=n.availableBooks,i=void 0===r?[]:r,c=_(n);return{initialData:n,allSongList:o,selectedBooks:i,availableBooks:i,booksVolumeRange:c,selectedBooksVolumeRange:Object(b.toPairs)(c).reduce((function(e,t){var n=Object(u.a)(t,2),a=n[0],o=n[1],r=Object(b.keys)(p).includes(a);return Object(l.a)(Object(l.a)({},e),{},Object(g.a)({},a,r?p[a]:o))}),{})}})),filterSongList:Object(j.b)((function(e){var t=e.allSongList,n=e.selectedBooksVolumeRange,a=e.selectedBooks;return{songList:t.filter((function(e){var t=e.book,o=e.volume;if(!a.includes(t))return!1;if(!Object(b.keys)(n).includes(t))return!0;if(Object(b.isEmpty)(n[t]))return!0;var r=Object(u.a)(n[t],2),i=r[0],c=r[1];return o>=i&&o<=c}))}}))},N={scrollToTop:function(){window.scrollTo({top:0,behavior:"smooth"})},updateKeywordParam:function(e){var t=e.keyword;s.push({search:"?k=".concat(t)})},restoreSetting:Object(j.b)((function(){var e,t,n=w(O.INITIAL_DATA);return{initialData:n,selectedBooksVolumeRange:w(O.SELECTED_BOOKS_VOLUME_RANGE),selectedBooks:w(O.SELECTED_BOOKS),booksVolumeRange:_(n),allSongList:null!==(e=null===n||void 0===n?void 0:n.songs)&&void 0!==e?e:[],availableBooks:null!==(t=null===n||void 0===n?void 0:n.availableBooks)&&void 0!==t?t:[]}})),storeSetting:function(e){var t=e.initialData,n=e.selectedBooksVolumeRange,a=e.selectedBooks;E(O.INITIAL_DATA,t),E(O.SELECTED_BOOKS,a),E(O.SELECTED_BOOKS_VOLUME_RANGE,n)}},T=Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({},N),D),L),{}),A=n(46),C=n.n(A),x={fetchInitialData:function(){return new Promise((function(e,t){C.a.get("/zhuo-zhu-data.json").then((function(t){e(t)})).catch((function(e){console.error(e),t(e)}))}))}},B=Object(f.a)({id:"ZhuoZhuSearch",context:{ReactGA:null,keyword:"",pageNumber:1,error:null,initialData:{},allSongList:[],availableBooks:["\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)","\u6c38\u96e3\u5fd8\u61f7\u60c5\u6b4c\u96c6(\u65cb\u5f8b\u7248)(\u7c21\u8b5c)","93\u6d41\u884c\u91d1\u66f2(\u7c21\u8b5c)","\u6c38\u6046\u7684\u65cb\u5f8b"],booksVolumeRange:{"\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)":[1,150]},selectedBooksVolumeRange:{"\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)":[1,150]},selectedBooks:["\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)","\u6c38\u96e3\u5fd8\u61f7\u60c5\u6b4c\u96c6(\u65cb\u5f8b\u7248)(\u7c21\u8b5c)","93\u6d41\u884c\u91d1\u66f2(\u7c21\u8b5c)","\u6c38\u6046\u7684\u65cb\u5f8b"],songList:[],result:[]},type:"parallel",states:h},{actions:T,guards:y,services:x}),K=n(52),I=Object(a.createContext)(),M=function(){return Object(a.useContext)(I)},G=function(e){var t=e.children,n=Object(d.useMachine)(B,{devTools:!1,context:{ReactGA:K.a}}),a=Object(u.a)(n,2),r=a[0],i=a[1];return o.a.createElement(I.Provider,{value:function(){var e=r.context;return{state:r,send:i,context:e,actions:Object(l.a)({},{openMenu:function(){return i("OPEN_MENU")},closeMenu:function(){return i("CLOSE_MENU")},toggleMenu:function(){return i("TOGGLE_MENU")},setKeyword:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i({type:"SET_KEYWORD",keyword:e,skipDebounce:t})},toggleClear:function(){return i("TOGGLE_CLEAR")},readMore:function(){return i("READ_MORE")},retry:function(){return i("RETRY")}})}}()},t)},P=function(){return o.a.createElement("div",{className:"idle-result"},"Please enter something to search.")},U=function(){return o.a.createElement("div",{className:"no-result"},"Nothing found.")},V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;Object(a.useEffect)((function(){var n=function(){window.innerHeight+window.pageYOffset>=document.body.offsetHeight-t&&e()};return window.addEventListener("scroll",n),function(){window.removeEventListener("scroll",n)}}))},W=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null,a=0,o=t.current,r=function(t){var o=(new Date).getTime(),r=o-a;clearTimeout(n),r>0&&r<450?(e(),t.preventDefault()):n=setTimeout((function(){clearTimeout(n)}),450),a=o};return o.addEventListener("click",r),function(){o.removeEventListener("click",r)}})),t},z=o.a.memo((function(e){var t,n=e.song,a=e.searchArtist,r=W((function(){var e=n.title,t=n.artist;!function(e,t){window.confirm('\u9023\u7d50\u81f3Youtube\u641c\u5c0b "'.concat(e,'" '))&&window.open("https://www.youtube.com/results?search_query=".concat(t),"_blank").focus()}(e,"".concat(e,"+").concat(t.replace(/[/+]/gi,"+")))})),i=W((function(){return a(n.artist)})),c={artist:""===(t=n).artist||"XXX"===t.artist?"-":t.artist.replace(/[/+]/gi,"\n"),position:""===t.volume?Object(b.toInteger)(t.page):"".concat(Object(b.toInteger)(t.volume),"/").concat(Object(b.toInteger)(t.page)),title:t.title},s=c.title,l=c.artist,u=c.position;return o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"row__title",ref:r},s),o.a.createElement("div",{className:"row__artist",ref:i},l),o.a.createElement("div",{className:"row__position"},u))})),Y=function(){var e=M(),t=e.context,n=t.pageNumber,r=void 0===n?1:n,i=t.result,c=void 0===i?[]:i,s=e.actions,l=s.readMore,u=s.setKeyword;V(l);var d=Object(a.useCallback)((function(e){u(e,!0)}),[]),f=c.slice(0,15*r);return o.a.createElement("div",null,f.map((function(e){return o.a.createElement(z,{key:"".concat(e.title).concat(e.volume).concat(e.page),song:e,searchArtist:d})})))},J=n(48),X=n.n(J),H=o.a.memo((function(e){var t=e.isLoading;return o.a.createElement("div",{className:"fetch-more-loading"},o.a.createElement("img",{src:X.a,alt:"icon",className:"fetch-more-loading__icon"+(t?"":" hide")}))})),Z=function(){var e=M().state;switch(!0){case e.matches("root.idle.searchPage.idle.idle"):return o.a.createElement(P,null);case e.matches("root.idle.searchPage.idle.withData"):return o.a.createElement(Y,null);case e.matches("root.idle.searchPage.idle.noData"):return o.a.createElement(U,null);default:return o.a.createElement(H,{isLoading:!0})}},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;Object(a.useEffect)((function(){var n=function(n){e&&!e.current.contains(n.target)&&t()};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),function(){document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}}),[e,t])},F=function(){var e=M(),t=e.context,n=t.keyword,o=t.result,r=e.actions,i=r.setKeyword,c=r.toggleClear,s=Object(a.useRef)(null),l=Object(a.useRef)(null);return q(l,(function(){s.current.blur()})),{inputText:n,inputRef:s,searchBoxRef:l,handleOnChange:function(e){i(e.target.value)},handleClearBtnClick:function(){c()},showSearchIcon:Object(b.isEmpty)(o)&&Object(b.isEmpty)(n),handleSearchBtnClick:function(){s.current.focus()}}},$=n(49),Q=n.n($),ee=n(50),te=n.n(ee),ne=function(){var e=F(),t=e.inputText,n=e.inputRef,a=e.searchBoxRef,r=e.handleOnChange,i=e.handleClearBtnClick,c=e.showSearchIcon,s=e.handleSearchBtnClick;return o.a.createElement("div",{className:"search-box",ref:a},o.a.createElement("input",{className:"search-box__input",type:"text",placeholder:"Title / Artist / Volume",value:t,ref:n,onChange:r}),c?o.a.createElement("img",{src:Q.a,alt:"icon",className:"search-box__icon search-box__icon--search",onClick:s}):o.a.createElement("img",{src:te.a,alt:"icon",className:"search-box__icon search-box__icon--cross",onClick:i}))},ae=function(){return o.a.createElement("div",{className:"main"},o.a.createElement("div",{className:"search-page-placeholder"}),o.a.createElement(ne,null),o.a.createElement(Z,null))},oe=function(){return o.a.createElement(G,null,o.a.createElement(ae,null))},re=n(85),ie=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ce(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(re.a,{history:s},o.a.createElement(oe,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/song-search-xstate-local",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/song-search-xstate-local","/service-worker.js");ie?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ce(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ce(t,e)}))}}()}},[[53,1,2]]]);
//# sourceMappingURL=main.13d67a7f.chunk.js.map