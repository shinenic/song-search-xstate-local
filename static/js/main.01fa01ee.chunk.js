(this["webpackJsonpsong-search-xstate-local"]=this["webpackJsonpsong-search-xstate-local"]||[]).push([[0],{48:function(e,t,n){e.exports=n.p+"static/media/loading.0f51771c.svg"},49:function(e,t,n){e.exports=n.p+"static/media/search.fa72ba04.svg"},50:function(e,t,n){e.exports=n.p+"static/media/cross.4f744e82.svg"},53:function(e,t,n){e.exports=n(83)},58:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var o=n(2),a=n.n(o),r=n(43),i=n.n(r),c=(n(58),n(17)),s=Object(c.a)(),l=n(11),u=n(20),d=n(47),f=n(26),g=n(15),v=function(e,t){return Math.random()*(t-e)+e},m={searchPage:{on:{SET_KEYWORD:[{cond:"isEmptyKeyword",actions:["setKeyword","resetResult"],target:".idle.idle"},{cond:"isInvalidKeyword",actions:["setKeyword"]},{cond:"skipDebounceSearch",actions:["setKeyword"],target:".searching"},{actions:["setKeyword"],target:".buffering",internal:!1}],TOGGLE_CLEAR:[{cond:"hasNoResult",actions:"clearKeyword",target:".idle.idle"},{cond:"withKeyword",actions:"clearKeyword"},{actions:"resetResult",target:".idle.idle"}]},initial:"idle",states:{idle:{initial:"idle",states:{idle:{},withData:{on:{READ_MORE:{actions:"readMore"}}},noData:{}}},buffering:{after:Object(g.a)({},500,"searching")},searching:{entry:["searchSongList","scrollToTop"],exit:["updateKeywordParam","sendDimension","setPageview"],always:[{cond:"hasNoResult",target:"idle.noData"},{target:"idle.withData"}]}}}},h={root:{initial:"startup",states:{startup:{entry:["initialGA","sendDimension","setPageview"],always:[{cond:"withSettingInLocalStorage",target:"idle",actions:["restoreSetting","filterSongList"]},{target:"fetchRawData"}]},fetchRawData:{invoke:{id:"fetch-initial-data",src:"fetchInitialData",onDone:{target:"idle",actions:["initializeData","storeSetting","filterSongList"]},onError:"error"}},processData:{after:Object(g.a)({},v(2e3,4e3),"arrangeRawData")},arrangeRawData:{after:Object(g.a)({},v(2e3,4e3),"optimizeSearchSpeed")},optimizeSearchSpeed:{after:Object(g.a)({},v(1e3,3e3),"idle")},idle:{type:"parallel",states:Object(l.a)(Object(l.a)({},{menu:{initial:"closed",on:{CLOSE_MENU:".closed",OPEN_MENU:".opened"},states:{closed:{on:{TOGGLE_MENU:"opened"}},opened:{on:{TOGGLE_MENU:"closed"}}}}}),m)},error:{on:{RETRY:"fetchRawData"}}}}},b=!1,w=n(7),E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=localStorage.getItem(e);return JSON.parse(t)},O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=JSON.stringify(t);return localStorage.setItem(e,n),n},p=(b(),{INITIAL_DATA:"initial-data",SELECTED_BOOKS_VOLUME_RANGE:"selected-books-volume-range",SELECTED_BOOKS:"selected-books"}),k={"\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)":[1,104]},y=["book","title","artist","volume"],j={withSettingInLocalStorage:function(){return Object(w.values)(p).every((function(e){return!Object(w.isEmpty)(E(e))}))},isEmptyKeyword:function(e,t){var n=t.keyword;return Object(w.isEmpty)(n)},isInvalidKeyword:function(e,t){var n,o=t.keyword;return n=Object(w.last)(o),/[\u3105-\u3129\u02CA\u02C7\u02CB\u02D9]/.test(n)||" "===Object(w.last)(o)},withKeyword:function(e){var t=e.keyword;return!Object(w.isEmpty)(t)},hasNoResult:function(e){var t=e.result;return Object(w.isEmpty)(t)},skipDebounceSearch:function(e,t){return t.skipDebounce}},S=n(3),R=n(44),_=function(e,t){var n=e.filter((function(e){return e.book===t})).map((function(e){var t=e.volume;return Object(w.toInteger)(t)}));return[Object(w.min)(n),Object(w.max)(n)]},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return((null===e||void 0===e?void 0:e.booksWithVolumeFilter)||[]).reduce((function(t,n){var o;return Object(l.a)(Object(l.a)({},t),{},Object(g.a)({},n,_(null!==(o=null===e||void 0===e?void 0:e.songs)&&void 0!==o?o:[],n)))}),{})},D={initialGA:function(e){e.ReactGA.initialize("UA-192564086-1",{debug:b})},setPageview:function(e){e.ReactGA.pageview(window.location.pathname+window.location.search)},sendDimension:function(e){var t=e.ReactGA,n=e.keyword,o=void 0===n?"":n;t.set({ua:navigator.userAgent}),t.set({k:o})}},N={setKeyword:Object(S.b)({keyword:function(e,t){var n=t.keyword;return void 0===n?"":n}}),clearKeyword:Object(S.b)({keyword:""}),resetResult:Object(S.b)({result:[],pageNumber:1}),readMore:Object(S.b)({pageNumber:function(e){return e.pageNumber+1}}),searchSongList:Object(S.b)({result:function(e){var t=e.songList,n=e.keyword;return Object(R.a)(t,n.replace(/[\r\n\s]/g,""),{keys:y})}}),initializeData:Object(S.b)((function(e,t){var n=t.data.data,o=n.songs,a=void 0===o?[]:o,r=n.availableBooks,i=void 0===r?[]:r,c=L(n);return{initialData:n,allSongList:a,selectedBooks:i,availableBooks:i,booksVolumeRange:c,selectedBooksVolumeRange:Object(w.toPairs)(c).reduce((function(e,t){var n=Object(u.a)(t,2),o=n[0],a=n[1],r=Object(w.keys)(k).includes(o);return Object(l.a)(Object(l.a)({},e),{},Object(g.a)({},o,r?k[o]:a))}),{})}})),filterSongList:Object(S.b)((function(e){var t=e.allSongList,n=e.selectedBooksVolumeRange,o=e.selectedBooks;return{songList:t.filter((function(e){var t=e.book,a=e.volume;if(!o.includes(t))return!1;if(!Object(w.keys)(n).includes(t))return!0;if(Object(w.isEmpty)(n[t]))return!0;var r=Object(u.a)(n[t],2),i=r[0],c=r[1];return a>=i&&a<=c}))}}))},T={scrollToTop:function(){window.scrollTo({top:0,behavior:"smooth"})},updateKeywordParam:function(e){var t=e.keyword;s.push({search:"?k=".concat(t)})},restoreSetting:Object(S.b)((function(){var e,t,n=E(p.INITIAL_DATA);return{initialData:n,selectedBooksVolumeRange:E(p.SELECTED_BOOKS_VOLUME_RANGE),selectedBooks:E(p.SELECTED_BOOKS),booksVolumeRange:L(n),allSongList:null!==(e=null===n||void 0===n?void 0:n.songs)&&void 0!==e?e:[],availableBooks:null!==(t=null===n||void 0===n?void 0:n.availableBooks)&&void 0!==t?t:[]}})),storeSetting:function(e){var t=e.initialData,n=e.selectedBooksVolumeRange,o=e.selectedBooks;O(p.INITIAL_DATA,t),O(p.SELECTED_BOOKS,o),O(p.SELECTED_BOOKS_VOLUME_RANGE,n)}},A=Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({},T),N),D),{}),C=n(46),x=n.n(C),B={fetchInitialData:function(){return new Promise((function(e,t){x.a.get("/zhuo-zhu-data.json").then((function(t){e(t)})).catch((function(e){console.error(e),t(e)}))}))}},K=Object(f.a)({id:"ZhuoZhuSearch",context:{ReactGA:null,keyword:"",pageNumber:1,error:null,initialData:{},allSongList:[],availableBooks:["\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)","\u6c38\u96e3\u5fd8\u61f7\u60c5\u6b4c\u96c6(\u65cb\u5f8b\u7248)(\u7c21\u8b5c)","93\u6d41\u884c\u91d1\u66f2(\u7c21\u8b5c)","\u6c38\u6046\u7684\u65cb\u5f8b"],booksVolumeRange:{"\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)":[1,150]},selectedBooksVolumeRange:{"\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)":[1,150]},selectedBooks:["\u6700\u65b0\u6392\u884c(\u7c21\u8b5c)","\u6c38\u96e3\u5fd8\u61f7\u60c5\u6b4c\u96c6(\u65cb\u5f8b\u7248)(\u7c21\u8b5c)","93\u6d41\u884c\u91d1\u66f2(\u7c21\u8b5c)","\u6c38\u6046\u7684\u65cb\u5f8b"],songList:[],result:[]},type:"parallel",states:h},{actions:A,guards:j,services:B}),I=n(52),M=Object(o.createContext)(),G=function(){return Object(o.useContext)(M)},P=function(e){var t=e.children,n=Object(d.useMachine)(K,{devTools:b,context:{ReactGA:I.a}}),o=Object(u.a)(n,2),r=o[0],i=o[1];b&&(console.table(r.value),console.log(r),console.log(r.context));return a.a.createElement(M.Provider,{value:function(){var e=r.context;return{state:r,send:i,context:e,actions:Object(l.a)({},{openMenu:function(){return i("OPEN_MENU")},closeMenu:function(){return i("CLOSE_MENU")},toggleMenu:function(){return i("TOGGLE_MENU")},setKeyword:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i({type:"SET_KEYWORD",keyword:e,skipDebounce:t})},toggleClear:function(){return i("TOGGLE_CLEAR")},readMore:function(){return i("READ_MORE")},retry:function(){return i("RETRY")}})}}()},t)},U=function(){return a.a.createElement("div",{className:"idle-result"},"Please enter something to search.")},V=function(){return a.a.createElement("div",{className:"no-result"},"Nothing found.")},W=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;Object(o.useEffect)((function(){var n=function(){window.innerHeight+window.pageYOffset>=document.body.offsetHeight-t&&e()};return window.addEventListener("scroll",n),function(){window.removeEventListener("scroll",n)}}))},z=function(e){var t=Object(o.useRef)();return Object(o.useEffect)((function(){var n=null,o=0,a=t.current,r=function(t){var a=(new Date).getTime(),r=a-o;clearTimeout(n),r>0&&r<450?(e(),t.preventDefault()):n=setTimeout((function(){clearTimeout(n)}),450),o=a};return a.addEventListener("click",r),function(){a.removeEventListener("click",r)}})),t},Y=a.a.memo((function(e){var t,n=e.song,o=e.searchArtist,r=z((function(){var e=n.title,t=n.artist;!function(e,t){window.confirm('\u9023\u7d50\u81f3Youtube\u641c\u5c0b "'.concat(e,'" '))&&window.open("https://www.youtube.com/results?search_query=".concat(t),"_blank").focus()}(e,"".concat(e,"+").concat(t.replace(/[/+]/gi,"+")))})),i=z((function(){return o(n.artist)})),c={artist:""===(t=n).artist||"XXX"===t.artist?"-":t.artist.replace(/[/+]/gi,"\n"),position:""===t.volume?Object(w.toInteger)(t.page):"".concat(Object(w.toInteger)(t.volume),"/").concat(Object(w.toInteger)(t.page)),title:t.title},s=c.title,l=c.artist,u=c.position;return a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"row__title",ref:r},s),a.a.createElement("div",{className:"row__artist",ref:i},l),a.a.createElement("div",{className:"row__position"},u))})),J=function(){var e=G(),t=e.context,n=t.pageNumber,r=void 0===n?1:n,i=t.result,c=void 0===i?[]:i,s=e.actions,l=s.readMore,u=s.setKeyword;W(l);var d=Object(o.useCallback)((function(e){u(e,!0)}),[]),f=c.slice(0,15*r);return a.a.createElement("div",null,f.map((function(e){return a.a.createElement(Y,{key:"".concat(e.title).concat(e.volume).concat(e.page),song:e,searchArtist:d})})))},X=n(48),H=n.n(X),Z=a.a.memo((function(e){var t=e.isLoading;return a.a.createElement("div",{className:"fetch-more-loading"},a.a.createElement("img",{src:H.a,alt:"icon",className:"fetch-more-loading__icon"+(t?"":" hide")}))})),q=function(){var e=G().state;switch(!0){case e.matches("root.idle.searchPage.idle.idle"):return a.a.createElement(U,null);case e.matches("root.idle.searchPage.idle.withData"):return a.a.createElement(J,null);case e.matches("root.idle.searchPage.idle.noData"):return a.a.createElement(V,null);default:return a.a.createElement(Z,{isLoading:!0})}},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;Object(o.useEffect)((function(){var n=function(n){e&&!e.current.contains(n.target)&&t()};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),function(){document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}}),[e,t])},$=function(){var e=G(),t=e.context,n=t.keyword,a=t.result,r=e.actions,i=r.setKeyword,c=r.toggleClear,s=Object(o.useRef)(null),l=Object(o.useRef)(null);return F(l,(function(){s.current.blur()})),{inputText:n,inputRef:s,searchBoxRef:l,handleOnChange:function(e){i(e.target.value)},handleClearBtnClick:function(){c()},showSearchIcon:Object(w.isEmpty)(a)&&Object(w.isEmpty)(n),handleSearchBtnClick:function(){s.current.focus()}}},Q=n(49),ee=n.n(Q),te=n(50),ne=n.n(te),oe=function(){var e=$(),t=e.inputText,n=e.inputRef,o=e.searchBoxRef,r=e.handleOnChange,i=e.handleClearBtnClick,c=e.showSearchIcon,s=e.handleSearchBtnClick;return a.a.createElement("div",{className:"search-box",ref:o},a.a.createElement("input",{className:"search-box__input",type:"text",placeholder:"Title / Artist / Volume",value:t,ref:n,onChange:r}),c?a.a.createElement("img",{src:ee.a,alt:"icon",className:"search-box__icon search-box__icon--search",onClick:s}):a.a.createElement("img",{src:ne.a,alt:"icon",className:"search-box__icon search-box__icon--cross",onClick:i}))},ae=function(){return a.a.createElement("div",{className:"main"},a.a.createElement("div",{className:"search-page-placeholder"}),a.a.createElement(oe,null),a.a.createElement(q,null))},re=function(){return a.a.createElement(P,null,a.a.createElement(ae,null))},ie=n(85),ce=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function se(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(ie.a,{history:s},a.a.createElement(re,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/song-search-xstate-local",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/song-search-xstate-local","/service-worker.js");ce?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):se(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):se(t,e)}))}}()}},[[53,1,2]]]);
//# sourceMappingURL=main.01fa01ee.chunk.js.map